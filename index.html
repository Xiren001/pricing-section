<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Card Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .generator-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1800px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .editor-row {
            display: grid;
            grid-template-columns: 80% 20%;
            gap: 30px;
        }

        .input-panel {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .preview-panel {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .panel-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            color: #333;
            border-bottom: 2px solid #7cb342;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #7cb342;
            box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.1);
        }

        .config-sections-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .offers-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .offer-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .offer-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #7cb342;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .image-upload-wrapper {
            margin-top: 10px;
        }

        .image-upload-wrapper label {
            display: block;
            margin-bottom: 8px;
        }

        .image-upload-wrapper input[type="file"] {
            padding: 5px;
        }

        .preview-image {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            border-radius: 4px;
            display: none;
        }

        .preview-image.active {
            display: block;
        }


        .paste-area {
            background: #f0f7e8;
            border: 2px dashed #7cb342;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .paste-area label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        .paste-area textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            font-family: monospace;
            resize: vertical;
            margin-bottom: 10px;
        }

        .paste-area textarea:focus {
            outline: none;
            border-color: #7cb342;
            box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.1);
        }

        .parse-button {
            background-color: #7cb342;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .parse-button:hover {
            background-color: #689f38;
        }

        .parse-button:active {
            transform: translateY(1px);
        }

        .shipping-banner {
            background-color: #f5a623;
            color: white;
            text-align: center;
            padding: 16px 20px;
            font-weight: 700;
            font-size: 28px;
        }

        .pricing-section {
            background-color: #f9f9f9;
            padding: 60px 20px;
        }

        .preview-section {
            display: none;
        }

        .preview-section.active {
            display: block;
        }

        .pricing-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .pricing-container.grid-cols-1 {
            grid-template-columns: repeat(1, 1fr);
        }
        
        .pricing-container.grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .pricing-container.grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .pricing-container.grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .pricing-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 50px 15px 20px 15px;
            text-align: center;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .pricing-card.featured {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .pricing-card.featured:hover {
            transform: translateY(-5px);
        }

        .pricing-card.highlighted {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .pricing-card.highlighted:hover {
            transform: translateY(-5px);
        }

        .pricing-card.card-dimmed .card-label {
            opacity: 0.5;
        }

        .card-label {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            font-size: 18px;
            font-weight: 900;
            letter-spacing: 1px;
            color: white;
            padding: 8px 15px;
            text-align: center;
            border-radius: 12px 12px 0 0;
            z-index: 5;
        }

        .featured .card-label {
            font-size: 19px;
        }

        .discount-badge {
            position: absolute;
            color: white;
            font-weight: 700;
            font-size: 36px;
            width: 90px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: visible;
        }

        .discount-badge svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .discount-badge span {
            position: relative;
            z-index: 2;
            text-align: center;
            line-height: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .badge-color-picker {
            margin-bottom: 15px;
        }

        .badge-color-picker label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .badge-color-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .badge-color-picker input[type="color"] {
            width: 60px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
        }

        .badge-color-picker input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
        }

        /* Added image upload and preview styling */
        .image-upload-area {
            position: relative;
            width: calc(100% + 30px);
            margin: -38px -15px 12px -15px;
            aspect-ratio: 1;
            border: none;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease;
            background-color: #fafafa;
            overflow: hidden;
        }

        .image-upload-area:hover {
            border-color: #7cb342;
            background-color: #f0f7e8;
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        .upload-placeholder {
            text-align: center;
            pointer-events: none;
        }

        .upload-placeholder svg {
            margin-bottom: 8px;
        }

        .upload-placeholder p {
            font-size: 12px;
            color: #999;
            margin: 0;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .product-image.active {
            display: block;
        }

        /* Added button link input styling */
        .button-link-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }

        .button-link-input:focus {
            outline: none;
            border-color: #7cb342;
            box-shadow: 0 0 0 3px rgba(124, 179, 66, 0.1);
        }

        .price {
            font-size: 38px;
            font-weight: 700;
            color: #7cb342;
            margin: 12px 0 6px;
        }

        .per-bottle {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .total {
            font-size: 18px;
            color: #666;
            margin-bottom: 12px;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            margin-right: 5px;
        }

        .you-save {
            font-size: 18px;
            color: #7cb342;
            font-weight: 700;
            margin-top: 8px;
        }

        /* Enhanced button styling for high conversion */
        .add-to-cart {
            width: 100%;
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 25px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 8px rgba(200, 90, 84, 0.2);
        }

        .add-to-cart:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(200, 90, 84, 0.3);
        }

        .add-to-cart:active {
            transform: translateY(0);
        }

        .guarantee {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
            font-weight: 700;
        }

        .guarantee-item {
            margin: 6px 0;
        }

        .bottom-section {
            max-width: 1200px;
            margin: 40px auto 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
            padding: 30px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .payment-processors {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .payment-text {
            font-size: 14px;
            color: #666;
            font-weight: 600;
            margin-right: 15px;
            margin-bottom: 15px;
        }

        .payment-logos {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .payment-logo {
            height: 40px;
            display: flex;
            align-items: center;
            background: white;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .payment-logo img {
            max-height: 100%;
            max-width: 100%;
        }

        .security-info {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .ssl-icon {
            flex-shrink: 0;
            margin-right: 15px;
        }

        .ssl-icon img {
            width: 80px;
            height: auto;
        }

        .security-text {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            flex: 1;
        }

        @media (max-width: 1200px) {
            .generator-container {
                padding: 20px 15px;
            }
            
            .editor-row {
                grid-template-columns: 1fr;
            }
            
            .editor-row .input-panel:first-child {
                order: 1;
            }
            
            .editor-row .input-panel:last-child {
                order: 2;
            }
            
            .input-panel {
                max-height: none;
            }
        }

        @media (max-width: 1200px) {
            .pricing-container.grid-cols-4 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 992px) {
            .pricing-container.grid-cols-3,
            .pricing-container.grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .shipping-banner {
                font-size: 18px;
                padding: 12px 16px;
            }

            .generator-container {
                padding: 15px 10px;
            }

            .input-panel,
            .preview-panel {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
            
            .config-sections-row {
                grid-template-columns: 1fr;
            }

            .pricing-container.grid-cols-1,
            .pricing-container.grid-cols-2,
            .pricing-container.grid-cols-3,
            .pricing-container.grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .pricing-card.featured {
                transform: scale(1);
            }

            .pricing-card.featured:hover {
                transform: translateY(-5px);
            }

            .bottom-section {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 25px 20px;
                margin: 30px auto 0;
                text-align: center;
            }

            .payment-processors {
                justify-content: center;
                flex-direction: column;
            }

            .payment-text {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .payment-logos {
                justify-content: center;
            }

            .security-info {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .ssl-icon img {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="generator-container">
        <!-- Editor Row -->
        <div class="editor-row">
            <!-- Left Editor Column -->
            <div class="input-panel">
                <h2 class="panel-title">Pricing Configuration</h2>
                
                <!-- Paste Area -->
                <div class="paste-area">
                    <label>ðŸ“‹ Paste Pricing Summary (Auto-fill all fields)</label>
                    <textarea id="pasteTextarea" placeholder="Paste your pricing summary here...&#10;&#10;Example:&#10;PRICING SUMMARY&#10;Currency: South African Rand (ZAR)&#10;Compare-at Price: R999.99&#10;&#10;---&#10;&#10;OFFER 1: Buy 1 Get 1 Free&#10;â€¢ Total Units: 2&#10;â€¢ Selling Price: R499.99&#10;..."></textarea>
                    <button class="parse-button" onclick="parsePricingSummary()">Auto-Fill All Fields</button>
                </div>
                
                <!-- Config Sections Row -->
                <div class="config-sections-row">
                <!-- General Settings -->
                <div class="offer-section" style="margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">General Settings</h3>
                    <div class="form-group">
                        <label>Language</label>
                        <select id="language" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish (EspaÃ±ol)</option>
                            <option value="de">German (Deutsch)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Currency</label>
                            <input type="text" id="currency" value="South African Rand (ZAR)" placeholder="e.g., South African Rand (ZAR)">
                        </div>
                        <div class="form-group">
                            <label>Currency Symbol</label>
                            <input type="text" id="currencySymbol" value="R" placeholder="e.g., R, $, â‚¬">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Compare-at Price (per bottle)</label>
                        <input type="number" id="compareAtPrice" value="999.99" step="0.01" placeholder="999.99">
                    </div>
                    <div class="form-group badge-color-picker">
                        <label>Theme Color</label>
                        <div class="badge-color-wrapper">
                            <input type="color" id="badgeColor" value="#7cb342">
                            <input type="text" id="badgeColorHex" value="#7cb342" placeholder="#7cb342" pattern="^#[0-9A-Fa-f]{6}$">
                        </div>
                    </div>
                    <div class="form-group badge-color-picker">
                        <label>Button Color</label>
                        <div class="badge-color-wrapper">
                            <input type="color" id="buttonColor" value="#c85a54">
                            <input type="text" id="buttonColorHex" value="#c85a54" placeholder="#c85a54" pattern="^#[0-9A-Fa-f]{6}$">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Highlight Card</label>
                        <select id="highlightCard" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="0">None</option>
                            <option value="1">Card 1</option>
                            <option value="2">Card 2</option>
                            <option value="3" selected>Card 3</option>
                        </select>
                    </div>
                </div>

                <!-- Content Settings -->
                <div class="offer-section" style="margin-bottom: 20px;">
                    <h3 style="margin-top: 0;">Content Settings</h3>
                    <div class="form-group">
                        <label>Shipping Banner Text</label>
                        <select id="shippingBanner" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="FREE Shipping For 2 & 4 Bottle Orders">FREE Shipping For 2 & 4 Bottle Orders</option>
                            <option value="Choose Your Package & Save Up To 50%">Choose Your Package & Save Up To 50%</option>
                            <option value="Most Customers Choose Our 3-Month Package">Most Customers Choose Our 3-Month Package</option>
                            <option value="Limited Time Offer â€“ Bigger Bundles Save More">Limited Time Offer â€“ Bigger Bundles Save More</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Card Label 1</label>
                            <input type="text" id="cardLabel1" value="STARTER ORDER" placeholder="STARTER ORDER">
                        </div>
                        <div class="form-group">
                            <label>Card Label 2</label>
                            <input type="text" id="cardLabel2" value="BIGGEST SAVINGS" placeholder="BIGGEST SAVINGS">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Card Label 3</label>
                        <input type="text" id="cardLabel3" value="MOST POPULAR" placeholder="MOST POPULAR">
                    </div>
                </div>
                </div>
            </div>

            <!-- Right Editor Column -->
            <div class="input-panel">
                <h2 class="panel-title">Pricing Offers</h2>
                <div class="offers-container" id="offersContainer">
            <!-- Offer 1 -->
            <div class="offer-section">
                <h3>Offer 1</h3>
                <div class="form-group">
                    <label>Selling Price (Total)</label>
                    <input type="number" id="offer1Price" value="499.99" step="0.01">
                    </div>
                <div class="form-group">
                    <label>Button Link</label>
                    <input type="url" id="offer1Link" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Product Image URL</label>
                    <input type="url" id="offer1Image" placeholder="https://...">
                    <img id="offer1ImagePreview" class="preview-image" alt="Preview" style="display: none;">
                </div>
            </div>

            <!-- Offer 2 -->
            <div class="offer-section">
                <h3>Offer 2</h3>
                <div class="form-group">
                    <label>Selling Price (Total)</label>
                    <input type="number" id="offer2Price" value="749.99" step="0.01">
                </div>
                <div class="form-group">
                    <label>Button Link</label>
                    <input type="url" id="offer2Link" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Product Image URL</label>
                    <input type="url" id="offer2Image" placeholder="https://...">
                    <img id="offer2ImagePreview" class="preview-image" alt="Preview" style="display: none;">
                </div>
            </div>

            <!-- Offer 3 -->
            <div class="offer-section">
                <h3>Offer 3</h3>
                <div class="form-group">
                    <label>Selling Price (Total)</label>
                    <input type="number" id="offer3Price" value="999.99" step="0.01">
                </div>
                <div class="form-group">
                    <label>Button Link</label>
                    <input type="url" id="offer3Link" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Product Image URL</label>
                    <input type="url" id="offer3Image" placeholder="https://...">
                    <img id="offer3ImagePreview" class="preview-image" alt="Preview" style="display: none;">
                </div>
            </div>
                </div>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <h2 class="panel-title">Live Preview</h2>
            
            <section class="shipping-banner" id="shippingBannerPreview">
        FREE Shipping For 2 & 4 Bottle Orders
    </section>

    <section class="pricing-section">
                <div class="pricing-container" id="pricingContainer">
                    <!-- Cards will be generated here -->
                    </div>

        <!-- Bottom Section -->
        <div class="bottom-section">
            <div>
                <div class="payment-text" id="paymentTextPreview">Our trusted payment processors:</div>
                <div class="payment-logos">
                            <img src="https://img.funnelish.com/77498/831339/1749739498-Group%201000002576.png" alt="Payment Methods" style="max-height: 50px; width: auto;">
                </div>
                </div>

            <div class="security-info">
                <div class="ssl-icon">
                            <img src="https://img.funnelish.com/77498/831339/1749739518-Capa_1.png" alt="SSL Secure" style="width: 80px; height: auto;">
            </div>
                <div class="security-text" id="securityTextPreview">
                    We use a 256-bit secure shopping cart where 100% of your data is encrypted, safe and secure. This is the same data security standard used by most banks, governments and military organizations.
                </div>
            </div>
        </div>
    </section>

            <!-- Copy Section -->
            <div style="margin-top: 30px; padding: 20px; background: #f0f7e8; border-radius: 8px; border: 2px solid #7cb342;">
                <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 15px; color: #333;">ðŸ“‹ Copy Section</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Click the button below to copy a self-contained HTML section that won't be affected by external CSS and won't affect other elements.</p>
                <button id="copySectionBtn" onclick="copySectionToClipboard()" style="background-color: #7cb342; color: white; border: none; padding: 12px 24px; font-size: 14px; font-weight: 700; border-radius: 6px; cursor: pointer; width: 100%; transition: background-color 0.3s ease;" onmouseover="this.style.backgroundColor='#689f38'" onmouseout="this.style.backgroundColor='#7cb342'">
                    Copy Section HTML
                </button>
                <textarea id="copiedCode" style="width: 100%; min-height: 200px; margin-top: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; font-family: monospace; display: none;" readonly></textarea>
                    </div>
                </div>
                </div>

    <!-- JavaScript for auto-calculation and card generation -->
    <script>
        const translations = {
            en: {
                perBottle: "Per bottle",
                total: "Total:",
                addToCart: "ADD TO CART",
                youSave: "You Save:",
                off: "OFF",
                guarantee1: "60 DAYS MONEY BACK GUARANTEE",
                guarantee2: "FREE SHIPPING",
                paymentProcessors: "Our trusted payment processors:",
                securityText: "We use a 256-bit secure shopping cart where 100% of your data is encrypted, safe and secure. This is the same data security standard used by most banks, governments and military organizations.",
                shippingBanners: [
                    "FREE Shipping For 2 & 4 Bottle Orders",
                    "Choose Your Package & Save Up To 50%",
                    "Most Customers Choose Our 3-Month Package",
                    "Limited Time Offer â€“ Bigger Bundles Save More"
                ],
                cardLabels: {
                    starter: "STARTER ORDER",
                    biggest: "BIGGEST SAVINGS",
                    popular: "MOST POPULAR"
                }
            },
            es: {
                perBottle: "Por botella",
                total: "Total:",
                addToCart: "AÃ‘ADIR AL CARRITO",
                youSave: "Ahorras:",
                off: "DESCUENTO",
                guarantee1: "GARANTÃA DE DEVOLUCIÃ“N DE DINERO DE 60 DÃAS",
                guarantee2: "ENVÃO GRATIS",
                paymentProcessors: "Nuestros procesadores de pago de confianza:",
                securityText: "Utilizamos un carrito de compras seguro de 256 bits donde el 100% de sus datos estÃ¡n encriptados, seguros y protegidos. Este es el mismo estÃ¡ndar de seguridad de datos utilizado por la mayorÃ­a de los bancos, gobiernos y organizaciones militares.",
                shippingBanners: [
                    "ENVÃO GRATIS Para Pedidos de 2 y 4 Botellas",
                    "Elige Tu Paquete y Ahorra Hasta 50%",
                    "La MayorÃ­a de los Clientes Eligen Nuestro Paquete de 3 Meses",
                    "Oferta por Tiempo Limitado â€“ Los Paquetes MÃ¡s Grandes Ahorran MÃ¡s"
                ],
                cardLabels: {
                    starter: "PEDIDO INICIAL",
                    biggest: "MAYOR AHORRO",
                    popular: "MÃS POPULAR"
                }
            },
            de: {
                perBottle: "Pro Flasche",
                total: "Gesamt:",
                addToCart: "IN DEN WARENKORB",
                youSave: "Sie sparen:",
                off: "RABATT",
                guarantee1: "60 TAGE GELD-ZURÃœCK-GARANTIE",
                guarantee2: "KOSTENLOSER VERSAND",
                paymentProcessors: "Unsere vertrauenswÃ¼rdigen Zahlungsabwickler:",
                securityText: "Wir verwenden einen 256-Bit-sicheren Warenkorb, in dem 100% Ihrer Daten verschlÃ¼sselt, sicher und geschÃ¼tzt sind. Dies ist derselbe Datensicherheitsstandard, der von den meisten Banken, Regierungen und militÃ¤rischen Organisationen verwendet wird.",
                shippingBanners: [
                    "KOSTENLOSER VERSAND FÃ¼r Bestellungen mit 2 & 4 Flaschen",
                    "WÃ¤hlen Sie Ihr Paket & Sparen Sie Bis Zu 50%",
                    "Die Meisten Kunden WÃ¤hlen Unser 3-Monats-Paket",
                    "Begrenztes Angebot â€“ GrÃ¶ÃŸere Pakete Sparen Mehr"
                ],
                cardLabels: {
                    starter: "STARTER BESTELLUNG",
                    biggest: "GRÃ–SSTE EINSPARUNGEN",
                    popular: "BELIEBTESTE"
                }
            }
        };

        const imageData = {
            offer1: null,
            offer2: null,
            offer3: null
        };
        const offerQuantities = {
            1: { buy: 1, free: 1 },
            2: { buy: 2, free: 3 },
            3: { buy: 3, free: 6 }
        };
        const perBottlePrices = {};
        const originalTotals = {};
        const savingsAmounts = {};
        let totalOffers = 3;

        function getCurrentLanguage() {
            const langSelect = document.getElementById('language');
            return langSelect ? langSelect.value : 'en';
        }

        function getTranslation(key) {
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            return t[key] || key;
        }

        function updateShippingBannerOptions() {
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            const select = document.getElementById('shippingBanner');
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '';
            
            t.shippingBanners.forEach(banner => {
                const option = document.createElement('option');
                option.value = banner;
                option.textContent = banner;
                if (banner === currentValue || (select.options.length === 0 && banner === t.shippingBanners[0])) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function updateCardLabels() {
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            const labels = t.cardLabels;
            
            const cardLabel1 = document.getElementById('cardLabel1');
            const cardLabel2 = document.getElementById('cardLabel2');
            const cardLabel3 = document.getElementById('cardLabel3');
            
            if (cardLabel1 && !cardLabel1.dataset.userModified) {
                cardLabel1.value = labels.starter;
            }
            if (cardLabel2 && !cardLabel2.dataset.userModified) {
                cardLabel2.value = labels.biggest;
            }
            if (cardLabel3 && !cardLabel3.dataset.userModified) {
                cardLabel3.value = labels.popular;
            }
        }

        function addOfferSection(offerNum) {
            const offersContainer = document.getElementById('offersContainer');
            if (!offersContainer) return;
            
            // Check if offer already exists
            if (document.getElementById(`offer${offerNum}Price`)) return;
            
            const offerHTML = `
                <div class="offer-section">
                    <h3>Offer ${offerNum}</h3>
                    <div class="form-group">
                        <label>Selling Price (Total)</label>
                        <input type="number" id="offer${offerNum}Price" value="0" step="0.01">
            </div>
                    <div class="form-group">
                        <label>Button Link</label>
                        <input type="url" id="offer${offerNum}Link" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Product Image URL</label>
                        <input type="url" id="offer${offerNum}Image" placeholder="https://..." oninput="handleImageUpload(this, 'offer${offerNum}')">
                        <img id="offer${offerNum}ImagePreview" class="preview-image" alt="Preview" style="display: none;">
                    </div>
                </div>
            `;
            
            offersContainer.insertAdjacentHTML('beforeend', offerHTML);
            imageData[`offer${offerNum}`] = null;
            
            // Initialize quantities if not already set
            if (!offerQuantities[offerNum]) {
                offerQuantities[offerNum] = { buy: 1, free: 0 };
            }
            
            // Add card label input if it doesn't exist
            if (offerNum > 3 && !document.getElementById(`cardLabel${offerNum}`)) {
                const cardLabel3 = document.getElementById('cardLabel3');
                if (cardLabel3) {
                    const contentSettings = cardLabel3.closest('.offer-section');
                    if (contentSettings) {
                        const labelHTML = `
                            <div class="form-group">
                                <label>Card Label ${offerNum}</label>
                                <input type="text" id="cardLabel${offerNum}" value="OFFER ${offerNum}" placeholder="OFFER ${offerNum}">
                            </div>
                        `;
                        contentSettings.insertAdjacentHTML('beforeend', labelHTML);
                        
                        const labelInput = document.getElementById(`cardLabel${offerNum}`);
                        if (labelInput) {
                            labelInput.addEventListener('input', updateCards);
                            labelInput.addEventListener('change', updateCards);
                        }
                    }
                }
            }
            
            // Add event listeners
            ['Price', 'Link', 'Image'].forEach(field => {
                const element = document.getElementById(`offer${offerNum}${field}`);
                if (element) {
                    if (field === 'Image') {
                        element.addEventListener('input', function() {
                            handleImageUpload(this, `offer${offerNum}`);
                        });
                    } else {
                        if (field === 'Price') {
                            // Clear stored per-bottle price when user manually changes price
                            element.addEventListener('input', function() {
                                delete perBottlePrices[offerNum];
                                updateCards();
                            });
                            element.addEventListener('change', function() {
                                delete perBottlePrices[offerNum];
                                updateCards();
                            });
                        } else {
                            element.addEventListener('input', updateCards);
                            element.addEventListener('change', updateCards);
                        }
                    }
                }
            });
            
            totalOffers = Math.max(totalOffers, offerNum);
        }

        function parsePricingSummary() {
            const text = document.getElementById('pasteTextarea').value;
            if (!text.trim()) {
                alert('Please paste the pricing summary text first');
                return;
            }

            try {
                // Clear stored values before parsing new data
                Object.keys(perBottlePrices).forEach(key => delete perBottlePrices[key]);
                Object.keys(originalTotals).forEach(key => delete originalTotals[key]);
                Object.keys(savingsAmounts).forEach(key => delete savingsAmounts[key]);
                
                // Parse currency
                const currencyMatch = text.match(/Currency:\s*(.+?)(?:\n|$)/i);
                if (currencyMatch) {
                    const currency = currencyMatch[1].trim();
                    document.getElementById('currency').value = currency;
                    
                    // Extract currency symbol from currency name or compare-at price
                    let symbol = 'R';
                    if (currency.includes('Rand') || currency.includes('ZAR')) symbol = 'R';
                    else if (currency.includes('Dollar') || currency.includes('USD')) symbol = '$';
                    else if (currency.includes('Euro') || currency.includes('EUR')) symbol = 'â‚¬';
                    else if (currency.includes('Pound') || currency.includes('GBP')) symbol = 'Â£';
                    else if (currency.includes('Yen') || currency.includes('JPY')) symbol = 'Â¥';
                    
                    document.getElementById('currencySymbol').value = symbol;
                }

                // Parse compare-at price - handle formats like "R999.99" or "Compare-at Price: R999.99"
                const compareMatch = text.match(/Compare-at Price:\s*([A-Z$â‚¬Â£Â¥]?)([\d,]+\.?\d*)/i);
                if (compareMatch) {
                    const price = compareMatch[2].replace(/,/g, '');
                    document.getElementById('compareAtPrice').value = parseFloat(price);
                    // Extract symbol from price if available
                    if (compareMatch[1]) {
                        document.getElementById('currencySymbol').value = compareMatch[1];
                    }
                }

                // Find all offers in the text - more flexible approach
                // First, find all OFFER numbers
                const offerNumbers = [];
                const offerNumberRegex = /OFFER\s+(\d+):/gi;
                let numMatch;
                while ((numMatch = offerNumberRegex.exec(text)) !== null) {
                    const offerNum = parseInt(numMatch[1]);
                    if (!offerNumbers.includes(offerNum)) {
                        offerNumbers.push(offerNum);
                    }
                }
                
                let maxOfferNum = 0;
                const offersData = [];
                
                // Process each offer number
                for (const offerNum of offerNumbers) {
                    try {
                        maxOfferNum = Math.max(maxOfferNum, offerNum);
                        
                        // Find the section for this offer
                        const offerStartRegex = new RegExp(`OFFER\\s+${offerNum}:`, 'i');
                        const offerStartIndex = text.search(offerStartRegex);
                        if (offerStartIndex === -1) continue;
                        
                        // Find where this offer section ends (start of next offer or end of text)
                        let offerEndIndex = text.length;
                        for (const nextOfferNum of offerNumbers) {
                            if (nextOfferNum > offerNum) {
                                const nextOfferStartRegex = new RegExp(`OFFER\\s+${nextOfferNum}:`, 'i');
                                const nextStartIndex = text.search(nextOfferStartRegex);
                                if (nextStartIndex !== -1 && nextStartIndex > offerStartIndex) {
                                    offerEndIndex = nextStartIndex;
                                    break;
                                }
                            }
                        }
                        
                        const offerSection = text.substring(offerStartIndex, offerEndIndex);
                        
                        // Extract buy and free quantities
                        const buyMatch = offerSection.match(/Buy\s+(\d+)/i);
                        const freeMatch = offerSection.match(/Get\s+(\d+)\s+Free/i);
                        const buyQty = buyMatch ? parseInt(buyMatch[1]) : 1;
                        const freeQty = freeMatch ? parseInt(freeMatch[1]) : 0;
                        
                        // Add offer section if it doesn't exist
                        if (offerNum > 3) {
                            try {
                                addOfferSection(offerNum);
                            } catch (err) {
                                console.warn(`Could not add offer section ${offerNum}:`, err);
                            }
                        }
                        
                        // Parse per-bottle price first (to avoid rounding issues)
                        let perBottlePriceMatch = null;
                        // Try "Per Bottle Price:" pattern first (most specific)
                        perBottlePriceMatch = offerSection.match(/[â€¢\*\-]?\s*Per Bottle Price:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        if (!perBottlePriceMatch) {
                            perBottlePriceMatch = offerSection.match(/Per Bottle Price:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        if (!perBottlePriceMatch) {
                            perBottlePriceMatch = offerSection.match(/[â€¢\*\-]\s*Per Bottle[:\s]+[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        if (!perBottlePriceMatch) {
                            perBottlePriceMatch = offerSection.match(/Per Bottle[:\s]+[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        if (!perBottlePriceMatch) {
                            perBottlePriceMatch = offerSection.match(/Per bottle[:\s]+[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        
                        let perBottlePrice = null;
                        if (perBottlePriceMatch && perBottlePriceMatch[1]) {
                            const priceStr = perBottlePriceMatch[1].replace(/,/g, '');
                            perBottlePrice = parseFloat(priceStr);
                            if (isNaN(perBottlePrice)) perBottlePrice = null;
                            else {
                                // Store the exact per-bottle price for this offer
                                perBottlePrices[offerNum] = perBottlePrice;
                            }
                        }
                        
                        // Parse selling price (total) - try multiple patterns
                        let sellingPriceMatch = null;
                        
                        // Pattern 1: With bullet and currency symbol
                        sellingPriceMatch = offerSection.match(/[â€¢\*\-]\s*Selling Price:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        
                        // Pattern 2: Without bullet, with currency symbol
                        if (!sellingPriceMatch) {
                            sellingPriceMatch = offerSection.match(/Selling Price:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        
                        // Pattern 3: Just "Selling Price" followed by price
                        if (!sellingPriceMatch) {
                            sellingPriceMatch = offerSection.match(/Selling Price[^â€¢\n]*?([\d,]+\.?\d*)/i);
                        }
                        
                        // Pattern 4: Look for price after "Selling Price" anywhere in the section
                        if (!sellingPriceMatch) {
                            const priceLines = offerSection.split('\n');
                            for (const line of priceLines) {
                                if (line.includes('Selling Price')) {
                                    const priceMatch = line.match(/([\d,]+\.?\d*)/);
                                    if (priceMatch) {
                                        sellingPriceMatch = priceMatch;
                                        break;
                                    }
                                }
                            }
                        }
                        
                        let price = null;
                        // Always use the selling price (total) from the text if available
                        // We'll use the stored per-bottle price in calculations instead
                        if (sellingPriceMatch && sellingPriceMatch[1]) {
                            const priceStr = sellingPriceMatch[1].replace(/,/g, '');
                            price = parseFloat(priceStr);
                            if (isNaN(price)) price = null;
                        }
                        
                        // Parse Original Total (strikethrough price)
                        let originalTotalMatch = null;
                        originalTotalMatch = offerSection.match(/[â€¢\*\-]?\s*Original Total[^:]*:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        if (!originalTotalMatch) {
                            originalTotalMatch = offerSection.match(/Original Total[^:]*:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        if (originalTotalMatch && originalTotalMatch[1]) {
                            const priceStr = originalTotalMatch[1].replace(/,/g, '');
                            const originalTotal = parseFloat(priceStr);
                            if (!isNaN(originalTotal)) {
                                originalTotals[offerNum] = originalTotal;
                            }
                        }
                        
                        // Parse You Save amount
                        let youSaveMatch = null;
                        youSaveMatch = offerSection.match(/[â€¢\*\-]?\s*You Save:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        if (!youSaveMatch) {
                            youSaveMatch = offerSection.match(/You Save:\s*[A-Z$â‚¬Â£Â¥]?([\d,]+\.?\d*)/i);
                        }
                        if (youSaveMatch && youSaveMatch[1]) {
                            const priceStr = youSaveMatch[1].replace(/,/g, '');
                            const savings = parseFloat(priceStr);
                            if (!isNaN(savings)) {
                                savingsAmounts[offerNum] = savings;
                            }
                        }
                        
                        // Store buy/free quantities
                        offerQuantities[offerNum] = { buy: buyQty, free: freeQty };
                        
                        offersData.push({
                            num: offerNum,
                            buy: buyQty,
                            free: freeQty,
                            price: price
                        });
                    } catch (err) {
                        console.warn(`Error processing offer ${offerNum}:`, err);
                        continue;
                    }
                }
                
                // Fill in the offers
                offersData.forEach(offer => {
                    try {
                        const priceInput = document.getElementById(`offer${offer.num}Price`);
                        if (priceInput) {
                            if (offer.price !== null && !isNaN(offer.price)) {
                                priceInput.value = offer.price;
                            }
                        }
                    } catch (err) {
                        console.warn(`Error filling offer ${offer.num}:`, err);
                    }
                });
                
                totalOffers = Math.max(totalOffers, maxOfferNum);
                
                if (offersData.length === 0) {
                    throw new Error('No offers found in the pricing summary');
                }

                // Update cards after parsing
                updateCards();
                
                // Show success message
                const button = document.querySelector('.parse-button');
                const originalText = button.textContent;
                button.textContent = 'âœ“ Auto-filled!';
                button.style.backgroundColor = '#4caf50';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#7cb342';
                }, 2000);

            } catch (error) {
                const errorMsg = error.message || 'Unknown error occurred';
                alert(`Error parsing pricing summary: ${errorMsg}\n\nPlease check the format and try again.`);
                console.error('Parsing error:', error);
                console.error('Text being parsed:', text.substring(0, 500));
            }
        }

        function handleImageUpload(input, offerId) {
            const imageUrl = input.value.trim();
            if (imageUrl) {
                imageData[offerId] = imageUrl;
                const preview = document.getElementById(offerId + 'ImagePreview');
                if (preview) {
                    preview.src = imageUrl;
                    preview.style.display = 'block';
                    preview.classList.add('active');
                }
                updateCards();
            } else {
                imageData[offerId] = null;
                const preview = document.getElementById(offerId + 'ImagePreview');
                if (preview) {
                    preview.style.display = 'none';
                    preview.classList.remove('active');
                }
                updateCards();
            }
        }

        function formatPrice(amount, symbol) {
            return symbol + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function calculateOffer(offerNum) {
            // Get buy and free quantities from stored data or use defaults
            const buyElement = document.getElementById(`offer${offerNum}Buy`);
            const freeElement = document.getElementById(`offer${offerNum}Free`);
            
            // Use stored quantities if available, otherwise use defaults or fallback
            const storedQuantities = offerQuantities[offerNum] || { buy: 1, free: 0 };
            const buy = buyElement ? parseInt(buyElement.value) || storedQuantities.buy : storedQuantities.buy;
            const free = freeElement ? parseInt(freeElement.value) || storedQuantities.free : storedQuantities.free;
            const sellingPrice = parseFloat(document.getElementById(`offer${offerNum}Price`).value) || 0;
            const compareAtPrice = parseFloat(document.getElementById('compareAtPrice').value) || 0;
            
            const totalUnits = buy + free;
            // Use stored original total if available (from parsing), otherwise calculate
            let originalTotal;
            if (originalTotals[offerNum] !== undefined) {
                originalTotal = originalTotals[offerNum];
            } else {
                originalTotal = totalUnits * compareAtPrice;
            }
            // Use stored per-bottle price if available (from parsing), otherwise calculate
            let perBottlePrice;
            if (perBottlePrices[offerNum] !== undefined) {
                perBottlePrice = perBottlePrices[offerNum];
            } else {
                perBottlePrice = sellingPrice / totalUnits;
            }
            const discount = ((originalTotal - sellingPrice) / originalTotal) * 100;
            // Use stored savings if available (from parsing), otherwise calculate
            let savings;
            if (savingsAmounts[offerNum] !== undefined) {
                savings = savingsAmounts[offerNum];
            } else {
                savings = originalTotal - sellingPrice;
            }
            
            return {
                buy,
                free,
                totalUnits,
                sellingPrice,
                originalTotal,
                perBottlePrice,
                discount: Math.round(discount),
                savings
            };
        }

        function generateCard(offerNum, offerData) {
            const symbol = document.getElementById('currencySymbol').value || 'R';
            const link = document.getElementById(`offer${offerNum}Link`).value || '#';
            const imageInput = document.getElementById(`offer${offerNum}Image`);
            const image = imageInput ? imageInput.value.trim() : (imageData[`offer${offerNum}`] || '');
            const hexInput = document.getElementById('badgeColorHex');
            const themeColor = (hexInput && /^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) ? hexInput.value.toUpperCase() : (document.getElementById('badgeColor').value || '#7CB342');
            const buttonHexInput = document.getElementById('buttonColorHex');
            const buttonColor = (buttonHexInput && /^#[0-9A-Fa-f]{6}$/.test(buttonHexInput.value)) ? buttonHexInput.value.toUpperCase() : (document.getElementById('buttonColor').value || '#C85A54');
            const highlightCard = parseInt(document.getElementById('highlightCard').value) || 0;
            const isHighlighted = highlightCard === offerNum;
            const isDimmed = highlightCard > 0 && !isHighlighted;
            
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            
            const cardLabel1 = document.getElementById('cardLabel1')?.value || t.cardLabels.starter;
            const cardLabel2 = document.getElementById('cardLabel2')?.value || t.cardLabels.biggest;
            const cardLabel3 = document.getElementById('cardLabel3')?.value || t.cardLabels.popular;
            const cardLabelInput = document.getElementById(`cardLabel${offerNum}`);
            const cardLabel = cardLabelInput ? cardLabelInput.value : (offerNum === 1 ? cardLabel1 : offerNum === 2 ? cardLabel2 : offerNum === 3 ? cardLabel3 : `OFFER ${offerNum}`);
            
            // Create wavy circle SVG for badge
            const badgeSVG = offerData.discount > 0 ? `
                <div class="discount-badge" style="background-color: ${themeColor};">
                    <svg width="90" height="90" viewBox="0 0 90 90" style="position: absolute; top: 0; left: 0;">
                        <circle cx="45" cy="45" r="42" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2" stroke-dasharray="4 4"/>
                        <circle cx="45" cy="45" r="38" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1.5" stroke-dasharray="3 3"/>
                    </svg>
                    <span style="position: relative; z-index: 1;">${offerData.discount}% <span style="font-size: 16px;">${t.off}</span></span>
                </div>
            ` : '';
            
            // Calculate label opacity
            const labelOpacity = isDimmed ? 0.5 : 1;
            const labelBgColor = themeColor;
            
            return `
                <div class="pricing-card ${isDimmed ? 'card-dimmed' : ''} ${isHighlighted ? 'highlighted' : ''}" style="${isHighlighted ? `border: 3px solid ${themeColor};` : ''}">
                    ${badgeSVG}
                    <div class="card-label" style="background-color: ${labelBgColor}; opacity: ${labelOpacity};">${cardLabel}</div>
                    <div class="image-upload-area" style="pointer-events: none;">
                        ${image ? `<a href="${link}" target="_blank" style="display: block; width: 100%; height: 100%;"><img src="${image}" class="product-image active" alt="Product" style="object-fit: cover; width: 100%; height: 100%; cursor: pointer;"></a>` : `
                        <div class="upload-placeholder">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                            <path d="M20 5v20M10 25l10-10l10 10" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                            <p>No image uploaded</p>
                    </div>
                        `}
                </div>
                    <div class="price" style="color: ${themeColor};">${formatPrice(offerData.perBottlePrice, symbol)}</div>
                    <div class="per-bottle" style="color: ${themeColor};">${t.perBottle}</div>
                    <div class="total">${t.total} ${offerData.originalTotal > offerData.sellingPrice ? `<span class="original-price">${formatPrice(offerData.originalTotal, symbol)}</span>` : ''}${formatPrice(offerData.sellingPrice, symbol)}</div>
                    <button class="add-to-cart" onclick="window.open('${link}', '_blank')" style="background-color: ${buttonColor};">${t.addToCart}</button>
                    ${offerData.savings > 0 ? `<div class="you-save" style="color: ${themeColor};">${t.youSave} ${formatPrice(offerData.savings, symbol)}</div>` : ''}
                <div class="guarantee">
                    <div class="guarantee-item">${t.guarantee1}</div>
                    <div class="guarantee-item">${t.guarantee2}</div>
                </div>
            </div>
            `;
        }

        function generateIsolatedHTML() {
            const symbol = document.getElementById('currencySymbol').value || 'R';
            const hexInput = document.getElementById('badgeColorHex');
            const themeColor = (hexInput && /^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) ? hexInput.value.toUpperCase() : (document.getElementById('badgeColor').value || '#7CB342');
            const buttonHexInput = document.getElementById('buttonColorHex');
            const buttonColor = (buttonHexInput && /^#[0-9A-Fa-f]{6}$/.test(buttonHexInput.value)) ? buttonHexInput.value.toUpperCase() : (document.getElementById('buttonColor').value || '#C85A54');
            const shippingBannerText = document.getElementById('shippingBanner').value || 'FREE Shipping For 2 & 4 Bottle Orders';
            const highlightCard = parseInt(document.getElementById('highlightCard').value) || 0;
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            let cardsHTML = '';
            
            // Find all available offers
            let maxOffer = 0;
            let cardCount = 0;
            for (let i = 1; i <= 20; i++) {
                if (document.getElementById(`offer${i}Price`)) {
                    maxOffer = i;
                    cardCount++;
                }
            }
            
            // Calculate grid columns: 3 cards = 3 cols, 4 cards = 4 cols, 5+ cards = 4 cols (wraps)
            const gridColumns = Math.min(cardCount, 4);
            
            for (let i = 1; i <= maxOffer; i++) {
                if (!document.getElementById(`offer${i}Price`)) continue;
                
                const offerData = calculateOffer(i);
                const link = document.getElementById(`offer${i}Link`).value || '#';
                const imageInput = document.getElementById(`offer${i}Image`);
                const image = imageInput ? imageInput.value.trim() : (imageData[`offer${i}`] || '');
                const cardLabel1 = document.getElementById('cardLabel1')?.value || t.cardLabels.starter;
                const cardLabel2 = document.getElementById('cardLabel2')?.value || t.cardLabels.biggest;
                const cardLabel3 = document.getElementById('cardLabel3')?.value || t.cardLabels.popular;
                const cardLabelInput = document.getElementById(`cardLabel${i}`);
                const cardLabel = cardLabelInput ? cardLabelInput.value : (i === 1 ? cardLabel1 : i === 2 ? cardLabel2 : i === 3 ? cardLabel3 : `OFFER ${i}`);
                const isHighlighted = highlightCard === i;
                
                const badgeSVG = offerData.discount > 0 ? `
                    <div class="pgc-discount-badge" style="background-color: ${themeColor};">
                        <svg width="90" height="90" viewBox="0 0 90 90" style="position: absolute; top: 0; left: 0;">
                            <circle cx="45" cy="45" r="42" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2" stroke-dasharray="4 4"/>
                            <circle cx="45" cy="45" r="38" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1.5" stroke-dasharray="3 3"/>
                        </svg>
                        <span style="position: relative; z-index: 1;">${offerData.discount}% <span style="font-size: 16px;">${t.off}</span></span>
                    </div>
                ` : '';
                
                cardsHTML += `
                    <div class="pgc-pricing-card ${isHighlighted ? 'pgc-highlighted' : ''}" style="${isHighlighted ? `border: 3px solid ${themeColor} !important;` : ''}">
                        ${badgeSVG}
                        <div class="pgc-card-label" style="background-color: ${themeColor}; color: white;">${cardLabel}</div>
                        <div class="pgc-image-area">
                            ${image ? `<a href="${link}" target="_blank" style="display: block; width: 100%; height: 100%;"><img src="${image}" class="pgc-product-image" alt="Product" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;"></a>` : `
                            <div class="pgc-upload-placeholder">
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                                    <path d="M20 5v20M10 25l10-10l10 10" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                                <p>No image uploaded</p>
                    </div>
                            `}
                    </div>
                        <div class="pgc-price" style="color: ${themeColor};">${formatPrice(offerData.perBottlePrice, symbol)}</div>
                        <div class="pgc-per-bottle" style="color: ${themeColor};">${t.perBottle}</div>
                        <div class="pgc-total">${t.total} ${offerData.originalTotal > offerData.sellingPrice ? `<span class="pgc-original-price">${formatPrice(offerData.originalTotal, symbol)}</span>` : ''}${formatPrice(offerData.sellingPrice, symbol)}</div>
                        <a href="${link}" target="_blank" class="pgc-add-to-cart" style="background-color: ${buttonColor} !important;">${t.addToCart}</a>
                        ${offerData.savings > 0 ? `<div class="pgc-you-save" style="color: ${themeColor};">${t.youSave} ${formatPrice(offerData.savings, symbol)}</div>` : ''}
                        <div class="pgc-guarantee">
                            <div class="pgc-guarantee-item">${t.guarantee1}</div>
                            <div class="pgc-guarantee-item">${t.guarantee2}</div>
                </div>
            </div>
                `;
            }
            
            const isolatedHTML = `<!-- Pricing Section - Isolated CSS -->
<style>
/* Reset and isolation */
.pgc-container * {
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
}

.pgc-shipping-banner {
    color: white !important;
    text-align: center !important;
    padding: 16px 20px !important;
    font-weight: 700 !important;
    font-size: 28px !important;
    width: 100% !important;
}

.pgc-pricing-section {
    background-color: white !important;
    padding: 60px 20px !important;
}

.pgc-pricing-container {
    max-width: 1200px !important;
    margin: 0 auto !important;
    display: grid !important;
    grid-template-columns: repeat(${gridColumns}, 1fr) !important;
    gap: 30px !important;
    margin-bottom: 50px !important;
}

@media (max-width: 1200px) {
    .pgc-pricing-container {
        grid-template-columns: repeat(${Math.min(gridColumns, 3)}, 1fr) !important;
    }
}

@media (max-width: 992px) {
    .pgc-pricing-container {
        grid-template-columns: repeat(${Math.min(gridColumns, 2)}, 1fr) !important;
    }
}

@media (max-width: 768px) {
    .pgc-pricing-container {
        grid-template-columns: 1fr !important;
    }
}

.pgc-pricing-card {
    background: white !important;
    border: 2px solid #e0e0e0 !important;
    border-radius: 12px !important;
    padding: 50px 15px 20px 15px !important;
    text-align: center !important;
    position: relative !important;
    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
}

.pgc-pricing-card:hover {
    transform: translateY(-5px) !important;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12) !important;
}

.pgc-pricing-card.pgc-featured {
    border: 3px solid #7cb342 !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
}

.pgc-pricing-card.pgc-featured:hover {
    transform: translateY(-5px) !important;
}

.pgc-pricing-card.pgc-highlighted {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
}

.pgc-pricing-card.pgc-highlighted:hover {
    transform: translateY(-5px) !important;
}

.pgc-card-label {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    font-size: 18px !important;
    font-weight: 900 !important;
    letter-spacing: 1px !important;
    padding: 8px 15px !important;
    text-align: center !important;
    border-radius: 12px 12px 0 0 !important;
    z-index: 5 !important;
}

.pgc-featured .pgc-card-label {
    font-size: 19px !important;
}

.pgc-discount-badge {
    position: absolute !important;
    color: white !important;
    font-weight: 700 !important;
    font-size: 36px !important;
    width: 90px !important;
    height: 90px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 50% !important;
    z-index: 1 !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    overflow: visible !important;
}

.pgc-discount-badge svg {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
}

.pgc-discount-badge span {
    position: relative !important;
    z-index: 2 !important;
    text-align: center !important;
    line-height: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
}

.pgc-image-area {
    position: relative !important;
    width: calc(100% + 30px) !important;
    margin: -38px -15px 12px -15px !important;
    aspect-ratio: 1 !important;
    border: none !important;
    border-radius: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background-color: #fafafa !important;
    overflow: hidden !important;
}

.pgc-upload-placeholder {
    text-align: center !important;
    pointer-events: none !important;
}

.pgc-upload-placeholder svg {
    margin-bottom: 8px !important;
}

.pgc-upload-placeholder p {
    font-size: 12px !important;
    color: #999 !important;
    margin: 0 !important;
}

.pgc-price {
    font-size: 38px !important;
    font-weight: 700 !important;
    margin: 12px 0 6px !important;
}

.pgc-per-bottle {
    font-size: 18px !important;
    margin-bottom: 8px !important;
}

.pgc-total {
    font-size: 18px !important;
    color: #666 !important;
    margin-bottom: 12px !important;
}

.pgc-original-price {
    text-decoration: line-through !important;
    color: #999 !important;
    margin-right: 5px !important;
}

.pgc-you-save {
    font-size: 18px !important;
    font-weight: 700 !important;
    margin-top: 8px !important;
}

.pgc-add-to-cart {
    width: 100% !important;
    max-width: 100% !important;
    color: white !important;
    border: none !important;
    padding: 14px 20px !important;
    font-size: 16px !important;
    font-weight: 700 !important;
    border-radius: 25px !important;
    cursor: pointer !important;
    margin-bottom: 10px !important;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease !important;
    box-shadow: 0 2px 8px rgba(200, 90, 84, 0.2) !important;
    text-decoration: none !important;
    display: block !important;
    text-align: center !important;
    box-sizing: border-box !important;
}

.pgc-add-to-cart:hover {
    opacity: 0.9 !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(200, 90, 84, 0.3) !important;
}

.pgc-guarantee {
    font-size: 14px !important;
    color: #333 !important;
    line-height: 1.5 !important;
    font-weight: 700 !important;
}

.pgc-guarantee-item {
    margin: 6px 0 !important;
}

.pgc-bottom-section {
    max-width: 1200px !important;
    margin: 40px auto 0 !important;
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 40px !important;
    align-items: center !important;
    padding: 30px !important;
    background: white !important;
    border: 2px solid #e0e0e0 !important;
    border-radius: 12px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
}

.pgc-payment-processors {
    display: flex !important;
    align-items: center !important;
    gap: 15px !important;
    flex-wrap: wrap !important;
}

.pgc-payment-text {
    font-size: 14px !important;
    color: #666 !important;
    font-weight: 600 !important;
    margin-right: 15px !important;
    margin-bottom: 15px !important;
}

.pgc-payment-logos {
    display: flex !important;
    gap: 15px !important;
    align-items: center !important;
}

.pgc-payment-logo {
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    background: white !important;
    padding: 5px 10px !important;
    border-radius: 4px !important;
}

.pgc-payment-logo img {
    max-height: 100% !important;
    max-width: 100% !important;
}

.pgc-security-info {
    display: flex !important;
    gap: 20px !important;
    align-items: flex-start !important;
}

.pgc-ssl-icon {
    flex-shrink: 0 !important;
    margin-right: 15px !important;
}

.pgc-ssl-icon img {
    width: 80px !important;
    height: auto !important;
}

.pgc-security-text {
    font-size: 14px !important;
    color: #666 !important;
    line-height: 1.6 !important;
    flex: 1 !important;
}

@media (max-width: 1200px) {
    .pgc-pricing-container {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 992px) {
    .pgc-pricing-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .pgc-shipping-banner {
        font-size: 20px !important;
        padding: 12px 16px !important;
    }
    
    .pgc-pricing-container {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
    }
    
    .pgc-pricing-card.pgc-featured:hover {
        transform: translateY(-5px) !important;
    }
    
    .pgc-bottom-section {
        grid-template-columns: 1fr !important;
        gap: 30px !important;
        padding: 25px 20px !important;
        margin: 30px auto 0 !important;
        text-align: center !important;
    }
    
    .pgc-payment-processors {
        justify-content: center !important;
        flex-direction: column !important;
    }
    
    .pgc-payment-text {
        margin-right: 0 !important;
        margin-bottom: 10px !important;
    }
    
    .pgc-payment-logos {
        justify-content: center !important;
    }
    
    .pgc-security-info {
        flex-direction: column !important;
        align-items: center !important;
        text-align: center !important;
    }
    
    .pgc-ssl-icon img {
        width: 60px !important;
    }
}
</style>

<section class="pgc-shipping-banner" style="background-color: ${themeColor};">
    ${shippingBannerText}
</section>

<section class="pgc-pricing-section">
    <div class="pgc-pricing-container">
        ${cardsHTML}
                </div>

    <div class="pgc-bottom-section">
        <div>
            <div class="pgc-payment-text">${t.paymentProcessors}</div>
            <div class="pgc-payment-logos">
                <img src="https://img.funnelish.com/77498/831339/1749739498-Group%201000002576.png" alt="Payment Methods" style="max-height: 50px; width: auto;">
            </div>
        </div>

        <div class="pgc-security-info">
            <div class="pgc-ssl-icon">
                <img src="https://img.funnelish.com/77498/831339/1749739518-Capa_1.png" alt="SSL Secure" style="width: 80px; height: auto;">
            </div>
            <div class="pgc-security-text">
                    ${t.securityText}
                </div>
            </div>
        </div>
</section>`;

            return isolatedHTML;
        }

        async function copySectionToClipboard() {
            const isolatedHTML = generateIsolatedHTML();
            const textarea = document.getElementById('copiedCode');
            textarea.value = isolatedHTML;
            textarea.style.display = 'block';
            
            try {
                await navigator.clipboard.writeText(isolatedHTML);
                
                const button = document.getElementById('copySectionBtn');
                const originalText = button.textContent;
                button.textContent = 'âœ“ Copied!';
                button.style.backgroundColor = '#4caf50';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#7cb342';
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                textarea.select();
                document.execCommand('copy');
                
                const button = document.getElementById('copySectionBtn');
                const originalText = button.textContent;
                button.textContent = 'âœ“ Copied!';
                button.style.backgroundColor = '#4caf50';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#7cb342';
                }, 2000);
            }
        }

        function updateCards() {
            const container = document.getElementById('pricingContainer');
            let html = '';
            
            // Find all available offers
            let maxOffer = 0;
            let cardCount = 0;
            for (let i = 1; i <= 20; i++) { // Check up to 20 offers
                if (document.getElementById(`offer${i}Price`)) {
                    maxOffer = i;
                    cardCount++;
                }
            }
            
            // Update highlight selector options
            updateHighlightSelector(maxOffer);
            
            // Set grid columns dynamically: 3 cards = 3 cols, 4 cards = 4 cols, 5+ cards = 4 cols (wraps)
            const gridColumns = Math.min(cardCount, 4);
            if (container) {
                // Remove all grid-cols classes
                container.classList.remove('grid-cols-1', 'grid-cols-2', 'grid-cols-3', 'grid-cols-4');
                // Add the appropriate class
                container.classList.add(`grid-cols-${gridColumns}`);
            }
            
            // Generate cards for all available offers
            for (let i = 1; i <= maxOffer; i++) {
                if (document.getElementById(`offer${i}Price`)) {
                    const offerData = calculateOffer(i);
                    html += generateCard(i, offerData);
                }
            }
            
            container.innerHTML = html;
            
            // Update shipping banner
            const shippingBanner = document.getElementById('shippingBanner');
            const shippingBannerPreview = document.getElementById('shippingBannerPreview');
            if (shippingBanner && shippingBannerPreview) {
                shippingBannerPreview.textContent = shippingBanner.value;
            }
            
            // Update preview text elements
            const lang = getCurrentLanguage();
            const t = translations[lang] || translations.en;
            const paymentTextPreview = document.getElementById('paymentTextPreview');
            const securityTextPreview = document.getElementById('securityTextPreview');
            if (paymentTextPreview) {
                paymentTextPreview.textContent = t.paymentProcessors;
            }
            if (securityTextPreview) {
                securityTextPreview.textContent = t.securityText;
            }
        }

        function updateHighlightSelector(maxOffer) {
            const highlightSelect = document.getElementById('highlightCard');
            if (!highlightSelect) return;
            
            const currentValue = highlightSelect.value;
            highlightSelect.innerHTML = '<option value="0">None</option>';
            
            for (let i = 1; i <= maxOffer; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Card ${i}`;
                if (i === parseInt(currentValue)) {
                    option.selected = true;
                }
                highlightSelect.appendChild(option);
            }
        }

        // Add event listeners to all input fields
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = [
                'currency', 'currencySymbol', 'compareAtPrice', 'badgeColor', 'badgeColorHex', 'buttonColor', 'buttonColorHex',
                'shippingBanner', 'highlightCard', 'cardLabel1', 'cardLabel2', 'cardLabel3',
                'offer1Price', 'offer1Link', 'offer1Image',
                'offer2Price', 'offer2Link', 'offer2Image',
                'offer3Price', 'offer3Link', 'offer3Image'
            ];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (id.includes('Image')) {
                        element.addEventListener('input', function() {
                            handleImageUpload(this, id.replace('Image', ''));
                        });
                    } else if (id.includes('Price') && id.startsWith('offer')) {
                        // Clear stored per-bottle price, original total, and savings when user manually changes price
                        const offerNum = id.replace('offer', '').replace('Price', '');
                        element.addEventListener('input', function() {
                            delete perBottlePrices[offerNum];
                            delete originalTotals[offerNum];
                            delete savingsAmounts[offerNum];
                            updateCards();
                        });
                        element.addEventListener('change', function() {
                            delete perBottlePrices[offerNum];
                            delete originalTotals[offerNum];
                            delete savingsAmounts[offerNum];
                            updateCards();
                        });
                    } else if (id === 'compareAtPrice') {
                        // Clear stored original totals and savings when compare-at price changes
                        element.addEventListener('input', function() {
                            Object.keys(originalTotals).forEach(key => delete originalTotals[key]);
                            Object.keys(savingsAmounts).forEach(key => delete savingsAmounts[key]);
                            updateCards();
                        });
                        element.addEventListener('change', function() {
                            Object.keys(originalTotals).forEach(key => delete originalTotals[key]);
                            Object.keys(savingsAmounts).forEach(key => delete savingsAmounts[key]);
                            updateCards();
                        });
                    } else {
                        element.addEventListener('input', updateCards);
                        element.addEventListener('change', updateCards);
                    }
                }
            });
            
            // Sync color picker and hex input for theme color
            const colorPicker = document.getElementById('badgeColor');
            const hexInput = document.getElementById('badgeColorHex');
            
            if (colorPicker && hexInput) {
                colorPicker.addEventListener('input', function() {
                    hexInput.value = this.value.toUpperCase();
                    updateCards();
                });
                
                hexInput.addEventListener('input', function() {
                    const hexValue = this.value;
                    if (/^#[0-9A-Fa-f]{6}$/.test(hexValue)) {
                        colorPicker.value = hexValue;
                        updateCards();
                    }
                });
            }
            
            // Sync color picker and hex input for button color
            const buttonColorPicker = document.getElementById('buttonColor');
            const buttonHexInput = document.getElementById('buttonColorHex');
            
            if (buttonColorPicker && buttonHexInput) {
                buttonColorPicker.addEventListener('input', function() {
                    buttonHexInput.value = this.value.toUpperCase();
                    updateCards();
                });
                
                buttonHexInput.addEventListener('input', function() {
                    const hexValue = this.value;
                    if (/^#[0-9A-Fa-f]{6}$/.test(hexValue)) {
                        buttonColorPicker.value = hexValue;
                        updateCards();
                    }
                });
            }
            
            // Language change event listener
            const languageSelect = document.getElementById('language');
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    updateShippingBannerOptions();
                    updateCardLabels();
                    updateCards();
                });
            }
            
            // Track user modifications to card labels
            ['cardLabel1', 'cardLabel2', 'cardLabel3'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        this.dataset.userModified = 'true';
                    });
                    element.addEventListener('focus', function() {
                        if (!this.dataset.userModified) {
                            this.dataset.userModified = 'false';
                        }
                    });
                }
            });
            
            // Initial update
            updateCards();
        });
    </script>
</body>
</html>
